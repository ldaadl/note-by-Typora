# 文件相关函数

## 随意列举

* file_get_contents()

````php
 file_get_contents(
    string $filename,
    bool $use_include_path = false,
    resource $context = ?,
    int $offset = 0,
    int $length = ?
): string|false
````

将一个文件的内容读取出为一个字符串

**注意**:    

​    如果要打开有特殊字符的 URL （比如说有空格），就需要使用    [urlencode()](https://www.php.net/manual/zh/function.urlencode.php) 进行 URL 编码。   

​	php://input和php://output是输入流和输出流，和Python中的sys.stdout和sys.stdin很相似，可以作为文件打开

## 文件操作

文件操作的基本步骤是：

1. 打开文件  文件对象=fopen(文件路径，文件模式，可选 include_path)
2. 读/写文件

3. 关闭文件   fclose(文件对象)

### 打开文件

打开文件使用fopen函数，但是要注意路径的问题和文件模式

#### 关于路径

路径和可以使用常见的相对路径和绝对路径，但是更常用的是基于以下变量的路径：

````php
$document_root=$_SERVER['DOCUMENT_ROOT'];
$fp = fopen("$documnet_root/[path]");
````

$_SERVER['DOCUMENT_ROOT']是一个超全局变量，它的值为项目的根目录。

#### 文件模式

| 模式 | 模式名称 | 意义                                                         |
| ---- | -------- | ------------------------------------------------------------ |
| r    | 只读     | 可读,从文件头开始读                                          |
| r+   |          | 可读可写，从文件头开始读写，写的话会覆盖原文件中相应长度的字符 |
| w    | 只写     | 可写，从文件头开始写，如果文件已经存在，将会删除文件内容，不存在将会创建新文件 |
| w+   |          | 可读可写，剩下同上                                           |
| x    | 谨慎写   | 写模式打开文件，若文件已存在，则fopen返回false，php发出警告  |
| x+   | 谨慎写   | 读写模式打开，其他同上                                       |
| a    | 追加模式 | 仅写                                                         |
| a+   |          | 读写                                                         |
| b    | 二进制   | Windows区分二进制文件和文本文件，而UNIX不区分，使用这个选项获得最大可移植性 |
| t    | 文本     |                                                              |

## 写文件的函数

* fwrite(文件对象,写入字符串,可选 写入长度)
* int file_put_contents(文件路径，写入数据)，无需打开和关闭文件

## 读文件的函数

读取一行数据：

* fgets(文件指针):读取文件的内容，直到\n或者文件结束符EOF为止，往往是读取一行
* fgetss(文件指针，可选 长度，可选 允许的HTML标记)：可以对读取的文件内容加以过滤，过滤掉一些指定的HTML标记防止恶意代码
* fgetcsv(文件指针，最大长度，可选 读取停止符，可选 ，可选)：最大长度为0时表示对读取长度不做限制，最大长度要大于实际读取长度

读取全部数据：

* readfile(文件路径,可选 include_path,可选)：无需打开关闭文件，读取整个文件;读取内容将被输出到标准输出，相当于echo了读取内容；返回读取结果true/false
* fpassthru(文件指针)：echo读取的文件内容；返回读取结果，true/false
* file(文件路径)：将文件中的内容分行读取到一个数组中
* file_get_contents(文件路径)：以字符串返回读取内容

读取一个字符：

* fget(文件指针)

读取任意长度：

* fread(文件指针，长度)

## 其他函数

* feof():在使用循环读取数据时常用的一个函数，while(!feof(文件指针)),feof()用于判断一个文件指针是否指向文件末尾，File End Of File
* file_exists(文件路径)：查看文件是否存在
* filesize(文件路径)：返回文件长度
* unlink(文件路径)：删除文件

文件定位：

* rewind(文件指针)：将指针复位到文件开头
* ftell(文件指针)：以字节为单位返回指针在文件中的位置
* fseek(文件指针，偏移量，起始位置):默认起始位置是SEEK_SET表示文件开始处，SEEK_CUR表示文件当前位置，SEEK_END表示文件结束处

## 文件锁

* flock(文件指针，操作类型)

| 操作类型 | 作用                               |
| -------- | ---------------------------------- |
| LOCK_SH  | 读操作锁定，文件可共享，其他认可读 |
| _EX      | 写操作锁定，其他人不可写           |
| _UN      | 释放已有锁定                       |
| _NB      | 防止请求加锁时发生组赛             |

<u>加锁后必须解锁</u>

